<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookMyStay - Professional Hotel & Vivah Bhaban Booking</title>
    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa; /* Lighter, warmer gray */
            color: #495057; /* Softer body text */
            line-height: 1.6;
        }
        
        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* --- Header --- */
        header {
            /* New professional blue gradient */
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            padding: 15px 0; /* More spacing */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px; /* More prominent */
            font-weight: 700;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        /* Base auth button style */
        .btn-auth {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s, transform 0.2s;
            border: 1px solid transparent;
        }
        
        /* Secondary (Outline) Style */
        #loginBtn, #logoutBtn {
            background-color: transparent;
            color: white;
            border-color: rgba(255, 255, 255, 0.7);
        }
        
        #loginBtn:hover, #logoutBtn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: white;
        }

        /* Primary (Solid) Style */
        #signupBtn, #myBookingsBtn {
            background-color: white;
            color: #1D4ED8; /* Match dark gradient blue */
            font-weight: 600;
        }

        #signupBtn:hover, #myBookingsBtn:hover {
            background-color: #f0f0f0;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .user-info span {
            font-weight: 500;
        }
        
        /* --- Hero Section --- */
        .hero {
            /* More professional background image */
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.pexels.com/photos/258154/pexels-photo-258154.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
            background-size: cover;
            background-position: center;
            padding: 60px 0; /* More vertical space */
            text-align: center;
            color: white;
            animation: fadeIn 1s ease-out;
        }

        .hero-title {
            font-size: 48px; /* Larger title */
            font-weight: 700;
            margin-bottom: 15px;
        }

        .hero-subtitle {
            font-size: 20px; /* Larger subtitle */
            font-weight: 400;
            opacity: 0.9;
        }
        
        /* --- Section Title --- */
        .section-title {
            font-size: 36px;
            font-weight: 700;
            margin-top: 30px;
            margin-bottom: 30px;
            color: #1D4ED8; /* New primary dark blue */
            text-align: center;
            /* Added a professional underline */
            display: inline-block;
            padding-bottom: 8px;
            border-bottom: 3px solid #3B82F6;
        }
        
        /* Center-align the section title */
        /* We need a wrapper to center the inline-block */
        .section-title-wrapper {
            text-align: center;
            margin-bottom: 30px; /* Re-apply margin here */
        }
        /* Remove margin from original title */
         .section-title {
            margin-bottom: 0;
         }

        
        /* --- Card Base Style --- */
        .card {
            background-color: white;
            border-radius: 8px; /* Standardized border radius */
            /* New subtle shadow */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef; /* Crisp border */
        }
        
        /* --- Search & Filter Card --- */
        .search-card {
            display: grid;
            /* Changed to 2 columns to force three rows */
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            align-items: end;
            animation: fadeInUp 0.6s ease-out;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        label svg {
            vertical-align: -3px;
            margin-right: 6px;
            opacity: 0.7;
        }
        
        /* --- Inputs --- */
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6; /* Lighter border */
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            background-color: #f8f9fa; /* Light fill */
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3B82F6; /* New primary blue focus */
            /* New focus shadow */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            background-color: #fff; /* White on focus */
        }
        
        /* --- Buttons --- */
        .btn {
            padding: 12px 20px;
            background-color: #3B82F6; /* New primary blue */
            color: white;
            border: 1px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s, color 0.3s, border-color 0.3s;
            width: 100%;
            text-align: center;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 48px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* Subtle shadow */
        }
        
        .btn:hover {
            background-color: #2563EB; /* Darker blue on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.07);
        }

        /* --- Hotel Grid --- */
        .hotel-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-top: 20px;
        }
        
        .hotel-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            animation: fadeInUp 0.6s ease-out;
        }
        
        .hotel-card:hover {
            transform: translateY(-5px);
            /* New hover shadow */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        
        .hotel-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .hotel-info {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .hotel-name {
            font-size: 24px; /* Larger */
            font-weight: 700;
            margin-bottom: 5px;
            color: #212529; /* Darker heading color */
        }
        
        .hotel-distance {
            font-size: 15px;
            font-weight: 600;
            color: #3B82F6; /* New primary blue */
            margin-bottom: 8px;
        }
        
        .hotel-location {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .hotel-location svg {
            vertical-align: -2px;
            margin-right: 4px;
            opacity: 0.7;
            flex-shrink: 0;
        }
        
        .hotel-rating {
            color: #ffc107;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .hotel-rating span {
            font-size: 12px;
            color: #6c757d;
            font-weight: 400;
            margin-left: 5px;
        }
        
        .hotel-description {
            color: #495057;
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .hotel-price {
            font-size: 22px; /* Larger */
            font-weight: 700;
            color: #1D4ED8; /* New primary dark blue */
            margin-bottom: 15px;
        }

        .hotel-price span {
            font-size: 14px;
            font-weight: 400;
            color: #6c757d;
        }
        
        /* --- Button Styles Overrides --- */
        .btn-book {
            background-color: #3B82F6; /* Primary blue */
        }
 
        .btn-book:hover {
            background-color: #2563EB;
        }
        
        .hotel-card-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: auto;
            width: 100%;
        }

        .hotel-card-actions .btn, .hotel-card-actions .btn-call {
            font-size: 14px;
            padding: 10px;
            height: auto; /* Reset height for these buttons */
        }
        
        /* Call button - Green for action */
        .btn-call {
            width: 100%;
            background-color: #198754; /* Green */
            text-align: center;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            text-decoration: none;
            display: block;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .btn-call:hover {
            background-color: #157347; /* Darker green */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.07);
        }
        
        /* Review button - Standard gray */
        .btn-review {
            background-color: #6c757d;
        }
        .btn-review:hover {
            background-color: #5a6268;
        }
        
        /* Nearest Me - Secondary (Outline) Style */
        #nearestBtn {
            background-color: #fff;
            color: #3B82F6;
            border: 1px solid #3B82F6;
        }
        #nearestBtn:hover {
            background-color: #f8f9fa;
            color: #2563EB;
            border-color: #2563EB;
        }
        
        @media (min-width: 768px) {
            .hotel-card {
                flex-direction: row;
                align-items: flex-start;
            }

            .hotel-image {
                width: 300px;
                height: 250px; /* Adjusted height */
            }

            .hotel-info {
                padding: 24px;
                flex: 1;
            }
        }
        
        @media (min-width: 992px) {
             .search-card .btn {
                align-self: end;
             }
        }


        /* --- Booking Form --- */
        .booking-form {
            display: none;
            margin-top: 30px;
        }
        
        .booking-form.active {
            display: block;
            animation: slideDown 0.5s ease-out;
        }

        #bookingForm h3 {
            font-size: 24px;
            font-weight: 600;
            color: #1D4ED8; /* New primary dark blue */
            margin-bottom: 20px;
            text-align: center;
        }

        .booking-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .form-actions {
            grid-column: 1 / -1;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 10px;
        }

        /* Confirm button - Green */
        .btn-confirm {
            background-color: #198754;
        }
        .btn-confirm:hover {
            background-color: #157347;
        }

        .btn-cancel {
            background-color: #6c757d;
        }
        .btn-cancel:hover {
            background-color: #5a6268;
        }

        .no-results {
            text-align: center;
            font-size: 18px;
            color: #6c757d;
            padding: 40px;
            width: 100%;
        }

        /* --- Notification --- */
        .notification {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
            display: none;
        }
        
        .notification.success,
        .notification.error {
            animation: slideDown 0.5s ease-out;
        }
        
        .success {
            background-color: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        
        .error {
            background-color: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
        
        /* --- Modal Styles --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            padding-top: 60px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px; /* Standardized */
            /* Stronger shadow */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            position: relative;
            animation: zoomIn 0.3s ease-out;
        }
        
        .modal-close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .modal-close:hover,
        .modal-close:focus {
            color: #000;
            text-decoration: none;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #1D4ED8; /* New primary dark blue */
            margin-bottom: 20px;
        }
        
        #reviewList {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        
        .review-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .review-item:last-child {
            border-bottom: none;
        }
        
        .review-item strong {
            display: block;
            color: #333;
            font-size: 16px;
        }
        
        .review-rating {
            color: #ffc107;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .review-item p {
            color: #555;
            font-size: 15px;
            margin: 0;
        }
        
        #reviewForm h3 {
            font-size: 20px;
            font-weight: 600;
            color: #1D4ED8;
            margin-bottom: 15px;
        }
        
        /* --- My Bookings Section --- */
        .bookings-section {
            display: none;
        }
        
        .bookings-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        .booking-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            border-left: 4px solid #3B82F6; /* New primary blue accent */
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .booking-hotel-name {
            font-size: 20px;
            font-weight: 700;
            color: #1D4ED8; /* New primary dark blue */
        }
        
        .booking-date {
            font-size: 14px;
            color: #6c757d;
        }
        
        .booking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .booking-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .booking-detail-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .booking-detail-value {
            font-size: 16px;
            font-weight: 500;
        }
        
        /* Status badges - These are already great, no change */
        .booking-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-confirmed {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 30px 0; /* More padding */
            margin-top: 40px;
            background-color: #212529; /* Dark footer */
            color: #f8f9fa; /* Light text */
            border-top: 1px solid #343a40;
        }
        
        /* --- Mobile Responsive Styles --- */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            /* Reduce font sizes */
            .hero-title {
                font-size: 32px; /* Increased from 24px */
            }
            .hero-subtitle {
                font-size: 18px; /* Increased from 16px */
            }
            .section-title {
                font-size: 28px; /* Increased from 24px */
            }
            .logo {
                font-size: 20px;
            }
            .hotel-name {
                font-size: 20px; /* Increased from 18px */
            }
            .hotel-price {
                font-size: 18px;
            }
            .modal-title {
                font-size: 20px;
            }
            
            /* Reduce padding */
            .card {
                padding: 15px;
            }
            .hotel-info {
                padding: 15px;
            }
            input, textarea, select {
                padding: 10px;
                font-size: 14px;
            }
            .btn {
                padding: 10px 15px;
                font-size: 14px;
                height: 44px;
            }
            .btn-auth {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            /* Adjust image height */
            .hotel-image {
                height: 180px;
            }
            
            .search-card {
                /* This existing rule will take over on mobile, creating 2 columns */
                /* grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); */
                /* New rule to force 2 columns on mobile as well */
                grid-template-columns: repeat(2, 1fr);
            }
            
            .hotel-card-actions {
                grid-template-columns: 1fr; /* Stack buttons vertically */
                gap: 10px;
            }
            
            .hotel-card-actions .btn, .hotel-card-actions .btn-call {
                font-size: 14px;
                padding: 12px;
            }
            
            .booking-form-grid {
                grid-template-columns: 1fr; /* Stack booking form inputs */
            }
            
            .booking-details {
                grid-template-columns: 1fr; /* Stack booking details */
                gap: 10px;
            }
            
            .booking-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .modal-content {
                width: 90%;
                padding: 20px;
                margin: 10% auto;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 10px;
            }
            .form-actions .btn {
                width: 100%;
            }
        }
        
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">BookMyStay</div>
                <div id="authButtons" class="auth-buttons">
                    <button class="btn-auth" id="loginBtn">Login</button>
                    <button class="btn-auth" id="signupBtn">Sign Up</button>
                </div>
                <div id="userInfo" class="user-info" style="display: none;">
                    <button class="btn-auth" id="myBookingsBtn">My Bookings</button>
                    <button class="btn-auth" id="logoutBtn">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <div class="hero">
        <div class="container">
            <h1 class="hero-title">Experience Luxury & Comfort</h1>
            <p class="hero-subtitle">Book premium hotels and vivah bhabans with ease and confidence</p>
        </div>
    </div>

    <div class="container">
        <!-- Customer App -->
        <div id="customerApp">
            <!-- Wrapped title in a div for centering -->
            <div class="section-title-wrapper">
                <h2 class="section-title">Find Hotels & Vivah Bhabans</h2>
            </div>
            
            <!-- Notification area -->
            <div id="customerNotification" class="notification"></div>

            <!-- Search Card -->
            <div class="card search-card">
                <!-- Location Filter -->
                <div class="form-group">
                    <label for="searchLocation">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                        </svg>
                        Location
                    </label>
                    <input type="text" id="searchLocation" placeholder="e.g., Mumbai, Delhi...">
                </div>
                
                <!-- Type Filter -->
                <div class="form-group">
                    <label for="filterType">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2h-11z"/>
                        </svg>
                        Type
                    </label>
                    <select id="filterType">
                        <option value="all">All</option>
                        <option value="hotel">Hotels</option>
                        <option value="vivah-bhaban">Vivah Bhabans</option>
                    </select>
                </div>
                
                <!-- Price Filter -->
                <div class="form-group">
                    <label for="filterPrice">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M4 10.781c.562-1.258 1.687-2.47 2.8-3.132.858-.51 1.762-.89 2.796-1.093l.112-1.298.111-.001.213 1.302L9.38 5.48a4.95 4.95 0 0 1 .39 1.255l.213-1.302.112.001.111 1.298c1.034.203 1.938.583 2.796 1.093 1.113.662 2.238 1.874 2.8 3.132l.112-.001.111 1.298-.213-1.302a5.007 5.007 0 0 1-.39-1.255l-.213 1.302-.112.001-.111-1.298A13.202 13.202 0 0 0 8.5 9.49l-.111 1.298-.112-.001-.213-1.302a4.963 4.963 0 0 1-.39 1.255l-.213-1.302-.112.001-.111 1.298c-1.034-.203-1.938-.583-2.796-1.093-1.113-.662-2.238-1.874-2.8-3.132l-.112.001-.111-1.298.213 1.302a5.007 5.007 0 0 1 .39-1.255l.213-1.302.112.001.111 1.298A13.202 13.202 0 0 0 3.5 9.49l.111 1.298.112.001.213-1.302a4.963 4.963 0 0 1 .39 1.255l.213-1.302L4 10.781zm.009-2.399A11.707 11.707 0 0 0 8 7.078a11.707 11.707 0 0 0 3.991 1.304l.111-1.298.112.001.213 1.302a4.987 4.987 0 0 1 .39-1.255l.213-1.302.112.001.111 1.298c.564.11 1.118.26 1.66.444l.111-1.298.112.001.213 1.302a4.987 4.987 0 0 1 .39-1.255l.213-1.302.112.001.111 1.298.112-.001.111 1.298-.213-1.302a5.007 5.007 0 0 1-.39-1.255l-.213 1.302-.112.001-.111-1.298c-.542-.184-1.096-.335-1.66-.444l-.111 1.298-.112-.001-.213-1.302a4.987 4.987 0 0 1-.39 1.255l-.213-1.302-.112.001-.111 1.298A11.707 11.707 0 0 0 8 4.078a11.707 11.707 0 0 0-3.991 1.304l-.111-1.298-.112.001-.213 1.302a4.987 4.987 0 0 1-.39 1.255l-.213-1.302-.112.001-.111 1.298c-.564-.11-1.118-.26-1.66-.444l-.111 1.298-.112-.001-.213 1.302a4.987 4.987 0 0 1-.39 1.255l-.213-1.302-.112.001-.111 1.298-.112.001-.111-1.298.213 1.302a5.007 5.007 0 0 1 .39 1.255l.213-1.302.112-.001.111 1.298c.542.184 1.096.335 1.66.444l.111-1.298.112.001.213 1.302a4.987 4.987 0 0 1 .39-1.255l.213-1.302.112.001.111 1.298z"/>
                          <path d="M4.01 8.382c.562-1.258 1.687-2.47 2.8-3.132.858-.51 1.762-.89 2.796-1.093l.112-1.298.111-.001.213 1.302L9.38 2.48a4.95 4.95 0 0 1 .39 1.255l.213-1.302.112.001.111 1.298c1.034.203 1.938.583 2.796 1.093 1.113.662 2.238 1.874 2.8 3.132l.112-.001.111 1.298-.213-1.302a5.007 5.007 0 0 1-.39-1.255l-.213 1.302-.112.001-.111-1.298A13.202 13.202 0 0 0 8.5 6.49l-.111 1.298-.112-.001-.213-1.302a4.963 4.963 0 0 1-.39 1.255l-.213-1.302-.112.001-.111 1.298c-1.034-.203-1.938-.583-2.796-1.093-1.113-.662-2.238-1.874-2.8-3.132l-.112.001-.111-1.298.213 1.302a5.007 5.007 0 0 1 .39-1.255l.213-1.302.112.001.111 1.298A13.202 13.202 0 0 0 3.5 6.49l.111 1.298.112.001.213-1.302a4.963 4.963 0 0 1 .39 1.255l.213-1.302L4 8.382z"/>
                        </svg>
                        Price Range
                    </label>
                    <select id="filterPrice">
                        <option value="all">All Prices</option>
                        <option value="2000">Under ‚Çπ2,000</option>
                        <option value="2000-5000">‚Çπ2,000 - ‚Çπ5,000</option>
                        <option value="5000">Over ‚Çπ5,000</option>
                    </select>
                </div>
                
                <!-- Rating Filter -->
                <div class="form-group">
                    <label for="filterRating">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M3.612 15.443c-.308.812-.624 1.5-1.034 2.031l-.107.135a.5.5 0 0 1-.708-.708l.107-.135c.41-.53.726-1.219 1.034-2.031.308-.812.624-1.5 1.034-2.031l.107-.135a.5.5 0 0 1 .708.708l-.107.135c-.41.53-.726 1.219-1.034 2.031zM8 1.5a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5zm.031 6.308a.5.5 0 0 1 .708 0l.106.106a.5.5 0 0 1 0 .708l-.106.106a.5.5 0 0 1-.708 0l-.106-.106a.5.5 0 0 1 0-.708l.106-.106zm-4.321 4.321a.5.5 0 0 1 .708 0l.106.106a.5.5 0 0 1 0 .708l-.106.106a.5.5 0 0 1-.708 0l-.106-.106a.5.5 0 0 1 0-.708l.106-.106zm8.642 0a.5.5 0 0 1 .708 0l.106.106a.5.5 0 0 1 0 .708l-.106.106a.5.5 0 0 1-.708 0l-.106-.106a.5.5 0 0 1 0-.708l.106-.106zM12.388 3.612a.5.5 0 0 1 .708 0l.106.106a.5.5 0 0 1 0 .708l-.106.106a.5.5 0 0 1-.708 0l-.106-.106a.5.5 0 0 1 0-.708l.106-.106zM3.612 3.612a.5.5 0 0 1 .708 0l.106.106a.5.5 0 0 1 0 .708l-.106.106a.5.5 0 0 1-.708 0l-.106-.106a.5.5 0 0 1 0-.708l.106-.106zM14.5 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM1.5 8a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5.5z"/>
                          <path d="M8 12a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm0 1a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/>
                        </svg>
                        Rating
                    </label>
                    <select id="filterRating">
                        <option value="all">Any Rating</option>
                        <option value="4">4+ Stars</option>
                        <option value="3">3+ Stars</option>
                    </select>
                </div>

                <!-- Buttons -->
                <button class="btn" id="searchBtn">Search</button>
                <button class="btn" id="nearestBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: -2px; margin-right: 6px;">
                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                    </svg>
                    Nearest Me
                </button>
            </div>
            
            <!-- Hotels List -->
            <div id="customerHotelsList" class="hotel-grid">
                <!-- Hotels will be loaded here -->
            </div>
            
            <!-- Booking Form -->
            <div id="bookingForm" class="booking-form card">
                <h3>Book <span id="bookingHotelName"></span></h3>
                <form id="customerBookingForm">
                    <input type="hidden" id="bookingHotelId">
                    <div class="booking-form-grid">
                        <div class="form-group">
                            <label for="customerName">Your Name</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="customerEmail">Email</label>
                            <input type="email" id="customerEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">Phone</label>
                            <input type="tel" id="customerPhone" required>
                        </div>
                        <div class="form-group">
                            <label for="checkInDate">Check-in Date</label>
                            <input type="date" id="checkInDate" required>
                        </div>
                        <div class="form-group">
                            <label for="checkOutDate">Check-out Date</label>
                            <input type="date" id="checkOutDate" required>
                        </div>
                        <div class="form-group">
                            <label for="guests">Number of Guests</label>
                            <input type="number" id="guests" min="1" required>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" id="cancelBookingBtn">Cancel</button>
                        <button type="submit" class="btn btn-confirm">Confirm Booking</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- My Bookings Section -->
        <div id="myBookingsSection" class="bookings-section">
            <div class="section-title-wrapper">
                <h2 class="section-title">My Bookings</h2>
            </div>
            
            <!-- Back button -->
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn" id="backToHomeBtn" style="background-color: #6c757d; max-width: 200px; display: inline-flex; align-items: center; justify-content: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16" style="vertical-align: -2px; margin-right: 6px;">
                      <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                    </svg>
                    Back to Home
                </button>
            </div>
            
            <div id="bookingsList">
                <!-- Bookings will be loaded here -->
            </div>
        </div>
        
        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" id="closeLoginModalBtn">&times;</span>
                <h2 class="modal-title">Login to Your Account</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginPhone">Phone Number</label>
                        <input type="tel" id="loginPhone" placeholder="10-digit phone number" pattern="[0-9]{10}" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn">Login</button>
                </form>
            </div>
        </div>
        
        <!-- Signup Modal -->
        <div id="signupModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" id="closeSignupModalBtn">&times;</span>
                <h2 class="modal-title">Create an Account</h2>
                <form id="signupForm">
                    <div class="form-group">
                        <label for="signupPhone">Phone Number</label>
                        <input type="tel" id="signupPhone" placeholder="10-digit phone number" pattern="[0-9]{10}" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" minlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="signupName">Full Name</label>
                        <input type="text" id="signupName" required>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email (Optional)</label>
                        <input type="email" id="signupEmail">
                    </div>
                    <button type="submit" class="btn">Sign Up</button>
                </form>
            </div>
        </div>
        
        <!-- Review Modal -->
        <div id="reviewModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" id="closeReviewModalBtn">&times;</span>
                <h2 class="modal-title" id="reviewModalTitle">Reviews</h2>
                
                <!-- List of existing reviews -->
                <div id="reviewList">
                    <!-- Reviews will be loaded here -->
                </div>
                
                <!-- Form to add a new review -->
                <form id="reviewForm">
                    <h3>Add Your Review ‚úçÔ∏è</h3>
                    <input type="hidden" id="reviewHotelId">
                    <div class="form-group">
                        <label for="reviewAuthorName">Your Name</label>
                        <input type="text" id="reviewAuthorName" required>
                        <p id="reviewCheckMessage" style="color: #dc3545; font-size: 14px; display: none; margin-top: 5px;">
                            You have already submitted a review for this hotel.
                        </p>
                    </div>
                    <div class="form-group">
                        <label for="reviewRating">Rating</label>
                        <select id="reviewRating" required>
                            <option value="">Select a rating</option>
                            <option value="5">üåüüåüüåüüåüüåü (Excellent)</option>
                            <option value="4">üåüüåüüåüüåü (Good)</option>
                            <option value="3">üåüüåüüåü (Average)</option>
                            <option value="2">üåüüåü (Poor)</option>
                            <option value="1">üåü (Terrible)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reviewComment">Comment</label>
                        <textarea id="reviewComment" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-confirm">Submit Review</button>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 BookMyStay. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyClBohbm2-pReGrbNMsm7ttDvwM2wEIfEo",
            authDomain: "miner-5939b.firebaseapp.com",
            databaseURL: "https://miner-5939b-default-rtdb.firebaseio.com",
            projectId: "miner-5939b",
            storageBucket: "miner-5939b.firebasestorage.app",
            messagingSenderId: "936240933139",
            appId: "1:936240933139:web:fe877e387fc82951d552e6",
            measurementId: "G-Z46V1K2XGN"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM Elements
        const customerHotelsList = document.getElementById('customerHotelsList');
        const searchLocation = document.getElementById('searchLocation');
        const filterType = document.getElementById('filterType');
        const filterPrice = document.getElementById('filterPrice');
        const filterRating = document.getElementById('filterRating');
        
        const searchBtn = document.getElementById('searchBtn');
        const nearestBtn = document.getElementById('nearestBtn');
        const bookingForm = document.getElementById('bookingForm');
        const bookingHotelName = document.getElementById('bookingHotelName');
        const bookingHotelId = document.getElementById('bookingHotelId');
        const customerBookingForm = document.getElementById('customerBookingForm');
        const cancelBookingBtn = document.getElementById('cancelBookingBtn');
        const customerNotification = document.getElementById('customerNotification');
        
        // Auth Elements
        const authButtons = document.getElementById('authButtons');
        const userInfo = document.getElementById('userInfo');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const myBookingsBtn = document.getElementById('myBookingsBtn');
        
        // Modal Elements
        const loginModal = document.getElementById('loginModal');
        const signupModal = document.getElementById('signupModal');
        const closeLoginModalBtn = document.getElementById('closeLoginModalBtn');
        const closeSignupModalBtn = document.getElementById('closeSignupModalBtn');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        
        // My Bookings Elements
        const myBookingsSection = document.getElementById('myBookingsSection');
        const bookingsList = document.getElementById('bookingsList');
        const backToHomeBtn = document.getElementById('backToHomeBtn');
        
        // Review Modal Elements
        const reviewModal = document.getElementById('reviewModal');
        const reviewModalTitle = document.getElementById('reviewModalTitle');
        const closeReviewModalBtn = document.getElementById('closeReviewModalBtn');
        const reviewList = document.getElementById('reviewList');
        const reviewForm = document.getElementById('reviewForm');
        const reviewHotelId = document.getElementById('reviewHotelId');
        
        let selectedHotelForBooking = null;
        let currentUser = null;

        // Initialize App
        function initApp() {
            setupEventListeners();
            checkAuthState();
            loadCustomerHotels();
        }

        // Set up event listeners
        function setupEventListeners() {
            searchBtn.addEventListener('click', loadCustomerHotels);
            nearestBtn.addEventListener('click', loadNearestHotels);
            customerBookingForm.addEventListener('submit', submitBooking);
            cancelBookingBtn.addEventListener('click', () => {
                bookingForm.classList.remove('active');
            });
            
            // Auth Event Listeners
            loginBtn.addEventListener('click', () => loginModal.style.display = 'block');
            signupBtn.addEventListener('click', () => signupModal.style.display = 'block');
            logoutBtn.addEventListener('click', logout);
            myBookingsBtn.addEventListener('click', showMyBookings);
            backToHomeBtn.addEventListener('click', showHomePage);
            
            // Modal Event Listeners
            closeLoginModalBtn.addEventListener('click', () => loginModal.style.display = 'none');
            closeSignupModalBtn.addEventListener('click', () => signupModal.style.display = 'none');
            loginForm.addEventListener('submit', handleLogin);
            signupForm.addEventListener('submit', handleSignup);
            
            // Review Modal Listeners
            reviewForm.addEventListener('submit', submitReview);
            closeReviewModalBtn.addEventListener('click', () => {
                reviewModal.style.display = 'none';
            });
            
            document.getElementById('reviewAuthorName').addEventListener('blur', checkExistingReview);
            
            window.addEventListener('click', (event) => {
                if (event.target == loginModal) loginModal.style.display = 'none';
                if (event.target == signupModal) signupModal.style.display = 'none';
                if (event.target == reviewModal) reviewModal.style.display = 'none';
            });
        }
        
        // Check authentication state
        function checkAuthState() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUIForUser();
            }
        }
        
        // Update UI based on authentication state
        function updateUIForUser() {
            if (currentUser) {
                authButtons.style.display = 'none';
                userInfo.style.display = 'flex';
            } else {
                authButtons.style.display = 'flex';
                userInfo.style.display = 'none';
                myBookingsSection.classList.remove('active');
            }
        }
        
        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!phone || !password) {
                showNotification('Please enter both phone and password.', 'error');
                return;
            }
            
            if (phone.length !== 10) {
                showNotification('Please enter a valid 10-digit phone number.', 'error');
                return;
            }
            
            database.ref('users').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        showNotification('No account found with this phone number.', 'error');
                        return;
                    }
                    
                    let userFound = false;
                    snapshot.forEach(childSnapshot => {
                        const user = childSnapshot.val();
                        if (user.password === password) {
                            userFound = true;
                            currentUser = {
                                id: childSnapshot.key,
                                phone: user.phone,
                                name: user.name,
                                email: user.email
                            };
                            
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            updateUIForUser();
                            
                            loginModal.style.display = 'none';
                            showNotification('Login successful! Welcome back, ' + user.name, 'success');
                            loginForm.reset();
                        }
                    });
                    
                    if (!userFound) {
                        showNotification('Incorrect password.', 'error');
                    }
                })
                .catch(error => {
                    showNotification('Error during login: ' + error.message, 'error');
                });
        }
        
        // Handle signup
        function handleSignup(e) {
            e.preventDefault();
            
            const phone = document.getElementById('signupPhone').value;
            const password = document.getElementById('signupPassword').value;
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            
            if (!phone || !password || !name) {
                showNotification('Please fill in all required fields.', 'error');
                return;
            }
            
            if (phone.length !== 10) {
                showNotification('Please enter a valid 10-digit phone number.', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters long.', 'error');
                return;
            }
            
            database.ref('users').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        showNotification('An account with this phone number already exists.', 'error');
                        return;
                    }
                    
                    const userData = {
                        phone: phone,
                        password: password,
                        name: name,
                        email: email || '',
                        createdAt: new Date().toISOString()
                    };
                    
                    database.ref('users').push(userData)
                        .then((newUserRef) => {
                            currentUser = {
                                id: newUserRef.key,
                                phone: phone,
                                name: name,
                                email: email || ''
                            };
                            
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            updateUIForUser();
                            
                            signupModal.style.display = 'none';
                            showNotification('Account created successfully! Welcome to BookMyStay, ' + name, 'success');
                            signupForm.reset();
                        })
                        .catch(error => {
                            showNotification('Error creating account: ' + error.message, 'error');
                        });
                })
                .catch(error => {
                    showNotification('Error checking user: ' + error.message, 'error');
                });
        }
        
        // Show Home Page
        function showHomePage() {
            myBookingsSection.classList.remove('active');
            document.getElementById('customerApp').style.display = 'block';
            window.scrollTo(0, 0);
        }
        
        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUIForUser();
            showNotification('You have been logged out.', 'success');
            showHomePage();
        }
        
        // Show My Bookings
        function showMyBookings() {
            if (!currentUser) {
                showNotification('Please log in to view your bookings.', 'error');
                return;
            }
            
            document.getElementById('customerApp').style.display = 'none';
            myBookingsSection.classList.add('active');
            loadUserBookings();
        }
        
        // Load user's bookings
        function loadUserBookings() {
            bookingsList.innerHTML = '<p>Loading your bookings...</p>';
            
            database.ref('bookings').orderByChild('customerPhone').equalTo(currentUser.phone).once('value')
                .then(snapshot => {
                    bookingsList.innerHTML = '';
                    
                    if (!snapshot.exists()) {
                        bookingsList.innerHTML = '<p class="no-results">You have no bookings yet.</p>';
                        return;
                    }
                    
                    let hasBookings = false;
                    snapshot.forEach(childSnapshot => {
                        const booking = childSnapshot.val();
                        booking.id = childSnapshot.key;
                        
                        const bookingCard = createBookingCard(booking);
                        bookingsList.appendChild(bookingCard);
                        hasBookings = true;
                    });
                    
                    if (!hasBookings) {
                        bookingsList.innerHTML = '<p class="no-results">You have no bookings yet.</p>';
                    }
                })
                .catch(error => {
                    bookingsList.innerHTML = '<p class="no-results">Error loading bookings.</p>';
                    showNotification('Error loading bookings: ' + error.message, 'error');
                });
        }
        
        // Create booking card
        function createBookingCard(booking) {
            const card = document.createElement('div');
            card.className = 'booking-card';
            
            let status = booking.status || 'Pending';
            let statusClass = 'status-pending';
            
            if (status === 'confirmed') {
                status = 'Confirmed';
                statusClass = 'status-confirmed';
            } else if (status === 'rejected') {
                status = 'Rejected';
                statusClass = 'status-cancelled';
            } else if (status === 'completed') {
                status = 'Completed';
                statusClass = 'status-completed';
            } else {
                status = 'Pending';
                statusClass = 'status-pending';
            }

            const checkInDate = new Date(booking.checkInDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0); 

            if (checkInDate < today && status !== 'Rejected') {
                status = 'Completed';
                statusClass = 'status-completed';
            }
            
            card.innerHTML = `
                <div class="booking-header">
                    <div class="booking-hotel-name">${booking.hotelName}</div>
                    <div class="booking-status ${statusClass}">${status}</div>
                </div>
                <div class="booking-details">
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Check-in</span>
                        <span class="booking-detail-value">${formatDate(booking.checkInDate)}</span>
                    </div>
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Check-out</span>
                        <span class="booking-detail-value">${formatDate(booking.checkOutDate)}</span>
                    </div>
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Guests</span>
                        <span class="booking-detail-value">${booking.guests}</span>
                    </div>
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Booked On</span>
                        <span class="booking-detail-value">${formatDate(booking.createdAt)}</span>
                    </div>
                </div>
                <div class="booking-details">
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Customer</span>
                        <span class="booking-detail-value">${booking.customerName}</span>
                    </div>
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Phone</span>
                        <span class="booking-detail-value">${booking.customerPhone}</span>
                    </div>
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Email</span>
                        <span class="booking-detail-value">${booking.customerEmail || 'N/A'}</span>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Format date for display
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }
        
        function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the earth in km
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const d = R * c; // Distance in km
            return d;
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }
        
        // Show notification
        function showNotification(message, type) {
            customerNotification.textContent = message;
            customerNotification.className = `notification ${type}`;
            customerNotification.style.display = 'block';
            
            customerNotification.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            setTimeout(() => {
                customerNotification.style.display = 'none';
            }, 5000);
        }

        function loadNearestHotels() {
            if (!navigator.geolocation) {
                showNotification('Geolocation is not supported by your browser.', 'error');
                return;
            }

            showNotification('Getting your location...', 'success');
            
            searchLocation.value = '';
            filterType.value = 'all';
            filterPrice.value = 'all';
            filterRating.value = 'all';

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    
                    showNotification('Location found! Finding nearest places...', 'success');
                    
                    database.ref('hotels').on('value', snapshot => {
                        customerHotelsList.innerHTML = '';
                        let hotelsWithDistance = [];
                        
                        if (snapshot.exists()) {
                            snapshot.forEach(childSnapshot => {
                                const hotel = childSnapshot.val();
                                hotel.id = childSnapshot.key;
                                
                                if (hotel.lat && hotel.lng) {
                                    const distance = getDistanceFromLatLonInKm(userLat, userLng, hotel.lat, hotel.lng);
                                    hotel.distance = distance;
                                    hotelsWithDistance.push(hotel);
                                }
                            });
                        }
                        
                        if (hotelsWithDistance.length > 0) {
                            hotelsWithDistance.sort((a, b) => a.distance - b.distance);
                            
                            hotelsWithDistance.forEach(hotel => {
                                const hotelCard = createCustomerHotelCard(hotel, true);
                                customerHotelsList.appendChild(hotelCard);
                                loadAndDisplayAverageRating(hotel.id, hotel.rating);
                            });
                        } else {
                            customerHotelsList.innerHTML = '<p class="no-results">No properties with location data (lat/lng) were found. Showing all properties instead.</p>';
                            loadCustomerHotels(false);
                        }
                    });
                },
                (error) => {
                    let errorMsg = 'Error getting location: ';
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'You denied the request for Geolocation.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'The request to get user location timed out.';
                            break;
                        case error.UNKNOWN_ERROR:
                            errorMsg += 'An unknown error occurred.';
                            break;
                    }
                    showNotification(errorMsg, 'error');
                }
            );
        }

        // Load hotels for customer
        function loadCustomerHotels() {
            document.getElementById('customerApp').style.display = 'block';
            myBookingsSection.classList.remove('active');
            
            const locationFilter = searchLocation.value.toLowerCase();
            const typeFilter = filterType.value;
            const priceFilter = filterPrice.value;
            const ratingFilter = filterRating.value;
            
            database.ref('hotels').on('value', snapshot => {
                customerHotelsList.innerHTML = '';
                let hasResults = false;
                if (snapshot.exists()) {
                    snapshot.forEach(childSnapshot => {
                        const hotel = childSnapshot.val();
                        hotel.id = childSnapshot.key;
                        
                        const matchesLocation = !locationFilter || (hotel.location && hotel.location.toLowerCase().includes(locationFilter));
                        const matchesType = typeFilter === 'all' || hotel.type === typeFilter;
                        
                        let matchesPrice = true;
                        const hotelPrice = parseFloat(hotel.price);
                        if (priceFilter !== 'all' && hotelPrice) {
                            switch (priceFilter) {
                                case '2000':
                                    matchesPrice = hotelPrice < 2000;
                                    break;
                                case '2000-5000':
                                    matchesPrice = hotelPrice >= 2000 && hotelPrice <= 5000;
                                    break;
                                case '5000':
                                    matchesPrice = hotelPrice > 5000;
                                    break;
                            }
                        } else if (priceFilter !== 'all' && !hotelPrice) {
                            matchesPrice = false;
                        }
                        
                        let matchesRating = true;
                        const hotelRating = parseInt(hotel.rating, 10);
                        if (ratingFilter !== 'all' && hotelRating) {
                             switch (ratingFilter) {
                                case '4':
                                    matchesRating = hotelRating >= 4;
                                    break;
                                case '3':
                                    matchesRating = hotelRating >= 3;
                                    break;
                            }
                        } else if (ratingFilter !== 'all' && !hotelRating) {
                            matchesRating = false;
                        }

                        if (matchesLocation && matchesType && matchesPrice && matchesRating) {
                            hasResults = true;
                            const hotelCard = createCustomerHotelCard(hotel, false);
                            customerHotelsList.appendChild(hotelCard);
                            loadAndDisplayAverageRating(hotel.id, hotel.rating);
                        }
                    });
                }
                
                if (!hasResults) {
                    customerHotelsList.innerHTML = '<p class="no-results">No properties found matching your criteria.</p>';
                }
            });
        }
        
        // Load and display average rating
        function loadAndDisplayAverageRating(hotelId, adminRating) {
            const ratingEl = document.getElementById(`rating-${hotelId}`);
            if (!ratingEl) return;
            
            const adminStars = adminRating ? '‚òÖ'.repeat(adminRating) + '‚òÜ'.repeat(5 - adminRating) : '‚òÜ'.repeat(5);
            ratingEl.innerHTML = `${adminStars} <span>(Admin Rating)</span>`;

            database.ref('hotels/' + hotelId + '/reviews').on('value', snapshot => {
                if (snapshot.exists()) {
                    let totalRating = 0;
                    let reviewCount = 0;
                    snapshot.forEach(reviewSnap => {
                        totalRating += Number(reviewSnap.val().rating);
                        reviewCount++;
                    });
                    
                    if (reviewCount > 0) {
                        const avgRating = (totalRating / reviewCount).toFixed(1);
                        const stars = '‚òÖ'.repeat(Math.round(avgRating)) + '‚òÜ'.repeat(5 - Math.round(avgRating));
                        ratingEl.innerHTML = `${stars} <span>(${avgRating} from ${reviewCount} reviews)</span>`;
                    }
                } else {
                    ratingEl.innerHTML = `${adminStars} <span>(Admin Rating)</span>`;
                }
            });
        }

        // Create customer hotel card
        function createCustomerHotelCard(hotel, showDistance = false) {
            const card = document.createElement('div');
            card.className = 'hotel-card';
            
            let distanceText = '';
            if (showDistance && hotel.distance !== undefined) {
                distanceText = `<div class="hotel-distance">${hotel.distance.toFixed(1)} km away</div>`;
            }
            
            const adminRating = hotel.rating || 0;
            const adminStars = '‚òÖ'.repeat(adminRating) + '‚òÜ'.repeat(5 - adminRating);
            
            let priceUnitText = 'per night';
            if (hotel.priceUnit) {
                priceUnitText = hotel.priceUnit;
            } else if (hotel.type === 'vivah-bhaban') {
                priceUnitText = 'per day';
            }
            
            card.innerHTML = `
                <img src="${hotel.image || 'https://placehold.co/600x440/eeeeee/cccccc?text=Image'}" alt="${hotel.name}" class="hotel-image" onerror="this.src='https://placehold.co/600x440/eeeeee/cccccc?text=Image+Not+Found'">
                <div class="hotel-info">
                    <div class="hotel-name">${hotel.name}</div>
                    ${distanceText}
                    <div class="hotel-location">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                        </svg>
                        ${hotel.location || 'Location not specified'}
                    </div>
                    <div class="hotel-rating" id="rating-${hotel.id}">${adminStars}</div>
                    <p class="hotel-description">${hotel.description || 'No description available.'}</p>
                    <div class="hotel-price">‚Çπ${hotel.price || 'N/A'} <span>${priceUnitText}</span></div>
                    <div class="hotel-card-actions">
                        <button class="btn btn-call" onclick="handleCallClick('${hotel.phone || ''}')" ${!(hotel.phone) ? 'style="background-color: #6c757d; cursor: not-allowed; opacity: 0.7;" disabled' : ''}>Call</button>
                        <button class="btn btn-review" onclick="handleReviewClick('${hotel.id}', '${String(hotel.name).replace(/'/g, "\\'")}')">Reviews üìù</button>
                        <button class="btn btn-book" onclick="handleBookClick('${hotel.id}')">Book Now</button>
                    </div>
                </div>
            `;
            return card;
        }

        // Handle Call button click
        function handleCallClick(phoneNumber) {
            if (!currentUser) {
                showNotification('Please log in to call the property.', 'error');
                loginModal.style.display = 'block';
                return;
            }
            
            if (phoneNumber) {
                window.location.href = 'tel:' + phoneNumber;
            } else {
                showNotification('Phone number is not available for this property.', 'error');
            }
        }

        // Handle Review button click
        function handleReviewClick(hotelId, hotelName) {
            if (!currentUser) {
                showNotification('Please log in to view or add reviews.', 'error');
                loginModal.style.display = 'block';
                return;
            }
            showReviewModal(hotelId, hotelName);
        }

        // Handle Book button click
        function handleBookClick(hotelId) {
            if (!currentUser) {
                showNotification('Please log in to book a property.', 'error');
                loginModal.style.display = 'block';
                return;
            }
            showBookingForm(hotelId);
        }

        // Show booking form
        function showBookingForm(hotelId) {
            database.ref('hotels/' + hotelId).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        showNotification('Error: This property could not be found.', 'error');
                        return;
                    }
                    const hotel = snapshot.val();
                    bookingHotelName.textContent = hotel.name;
                    bookingHotelId.value = hotelId;
                    selectedHotelForBooking = hotel;
                    
                    customerBookingForm.reset();
                    
                    if (currentUser) {
                        document.getElementById('customerName').value = currentUser.name || '';
                        document.getElementById('customerEmail').value = currentUser.email || '';
                        document.getElementById('customerPhone').value = currentUser.phone || '';
                    }
                    
                    bookingForm.classList.add('active');
                    bookingForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
        }
        
        // Show Review Modal
        function showReviewModal(hotelId, hotelName) {
            reviewModalTitle.textContent = `Reviews for ${hotelName}`;
            reviewHotelId.value = hotelId;
            reviewForm.reset();
            
            const reviewFormContainer = document.getElementById('reviewForm');
            if (currentUser) {
                reviewFormContainer.style.display = 'block';
                setReviewFormEnabled(true);
            } else {
                reviewFormContainer.style.display = 'none';
            }
            
            reviewList.innerHTML = '<p>Loading reviews...</p>';
            reviewModal.style.display = 'block';
            
            database.ref('hotels/' + hotelId + '/reviews').once('value', snapshot => {
                reviewList.innerHTML = '';
                if (!snapshot.exists()) {
                    reviewList.innerHTML = '<p>No reviews yet. Be the first to add one!</p>';
                    return;
                }
                
                snapshot.forEach(reviewSnap => {
                    const review = reviewSnap.val();
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'review-item';
                    reviewItem.innerHTML = `
                        <strong>${review.authorName}</strong>
                        <div class="review-rating">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}</div>
                        <p>${review.comment}</p>
                    `;
                    reviewList.prepend(reviewItem);
                });
            });
        }
        
        // Helper function to enable/disable review form
        function setReviewFormEnabled(enabled) {
            const checkMsg = document.getElementById('reviewCheckMessage');
            const ratingSelect = document.getElementById('reviewRating');
            const commentText = document.getElementById('reviewComment');
            const submitBtn = document.querySelector('#reviewForm button[type="submit"]');

            if (enabled) {
                checkMsg.style.display = 'none';
                ratingSelect.disabled = false;
                commentText.disabled = false;
                submitBtn.disabled = false;
            } else {
                checkMsg.style.display = 'block';
                ratingSelect.disabled = true;
                commentText.disabled = true;
                submitBtn.disabled = true;
            }
        }
        
        // Check if user has already reviewed
        function checkExistingReview() {
            const authorName = document.getElementById('reviewAuthorName').value.trim();
            if (!authorName) {
                setReviewFormEnabled(true);
                return;
            }

            const hotelId = reviewHotelId.value;
            const reviewRef = database.ref('hotels/' + hotelId + '/reviews');
            const authorQuery = reviewRef.orderByChild('authorName').equalTo(authorName);

            authorQuery.once('value').then(snapshot => {
                if (snapshot.exists()) {
                    setReviewFormEnabled(false);
                } else {
                    setReviewFormEnabled(true);
                }
            });
        }
        
        // Submit Review
        function submitReview(e) {
            e.preventDefault();
            
            if (!currentUser) {
                 showNotification('Please log in to submit a review.', 'error');
                 return;
            }
            
            const hotelId = reviewHotelId.value;
            const reviewData = {
                authorName: document.getElementById('reviewAuthorName').value,
                rating: Number(document.getElementById('reviewRating').value),
                comment: document.getElementById('reviewComment').value,
                createdAt: new Date().toISOString()
            };
            
            if (!reviewData.authorName || !reviewData.rating || !reviewData.comment) {
                showNotification('Please fill in all review fields.', 'error');
                return;
            }
            
            const reviewRef = database.ref('hotels/' + hotelId + '/reviews');
            const authorQuery = reviewRef.orderByChild('authorName').equalTo(reviewData.authorName);

            authorQuery.once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        showNotification('You have already submitted a review for this hotel.', 'error');
                    } else {
                        reviewRef.push(reviewData)
                            .then(() => {
                                showNotification('Review submitted successfully!', 'success');
                                reviewForm.reset();
                                const hotelName = reviewModalTitle.textContent.replace('Reviews for ', '');
                                showReviewModal(hotelId, hotelName);
                            })
                            .catch(error => {
                                showNotification('Error submitting review: ' + error.message, 'error');
                            });
                    }
                })
                .catch(error => {
                    showNotification('Error checking for existing review: ' + error.message, 'error');
                });
        }

        // Submit booking
        function submitBooking(e) {
            e.preventDefault();
            
            const bookingData = {
                hotelId: bookingHotelId.value,
                hotelName: selectedHotelForBooking ? selectedHotelForBooking.name : 'Unknown',
                customerName: document.getElementById('customerName').value,
                customerEmail: document.getElementById('customerEmail').value,
                customerPhone: document.getElementById('customerPhone').value,
                checkInDate: document.getElementById('checkInDate').value,
                checkOutDate: document.getElementById('checkOutDate').value,
                guests: document.getElementById('guests').value,
                createdAt: new Date().toISOString(),
                status: 'pending'
            };
            
            database.ref('bookings').push(bookingData)
                .then(() => {
                    showNotification('Booking confirmed! We will contact you shortly.', 'success');
                    customerBookingForm.reset();
                    bookingForm.classList.remove('active');
                    
                    if (currentUser) {
                        loadUserBookings();
                    }
                })
                .catch(error => {
                    showNotification('Error submitting booking: ' + error.message, 'error');
                });
        }

        // Initialize the app
        initApp();
    </script>
</body>
</html>
